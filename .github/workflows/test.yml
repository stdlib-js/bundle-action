
#/
# @license Apache-2.0
#
# Copyright (c) 2022 The Stdlib Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#/

# Workflow name:
name: Bundle

# Workflow triggers:
on:
  # Allow the workflow to be manually run:
  workflow_dispatch:
    inputs:
      repository:
        description: 'Repository to bundle'
        default: 'stdlib-js/utils-keys'
      ref:
        description: 'Target branch'
        default: 'production'
      minify:
        type: boolean
        description: 'Minify bundle'
        default: true
      target:
        type: choice
        description: 'Bundle target'
        default: 'umd-browser'
        options:
          - 'umd-browser'
          - 'umd-node'
          - 'esm'
          - 'deno'

# Workflow jobs:
jobs:
  bundle:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout repository'
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          repository: '${{ github.event.inputs.repository }}'
          ref: '${{ github.event.inputs.ref }}'
      - name: 'Setup Node.js'
        uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6.1.0
        with:
          node-version: 20
        timeout-minutes: 5
      - name: 'Install production and development dependencies'
        id: 'install'
        run: |
          npm install || npm install || npm install
        timeout-minutes: 15
      - name: 'Create bundle'
        id: 'bundle'
        uses: stdlib-js/bundle-action@main
        with:
          target: '${{ github.event.inputs.target }}'
          minify: '${{ github.event.inputs.minify }}'
      - name: 'Upload artifact'
        uses: actions/upload-artifact@330a01c490aca151604b8cf639adc76d48f6c5d4 # v5.0.0
        with:
          name: '${{ github.event.inputs.target }}-bundle'
          path: |
            umd/index.js
            umd/index.js.map
            umd/browser.js
            umd/browser.js.map
            esm/index.d.ts
            esm/index.mjs
            esm/index.mjs.map
            deno/mod.d.ts
            deno/mod.js
            deno/mod.js.map
